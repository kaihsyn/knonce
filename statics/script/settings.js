// Generated by CoffeeScript 1.5.0
(function() {
  var refresh_notebook_name, refreshing;

  refreshing = false;

  refresh_notebook_name = function() {
    if (refreshing) {
      return;
    }
    refreshing = true;
    $('#nb-select-name-refresh>i').addClass('icon-spin');
    $.get('/settings/notebook/name').fail(function(data) {
      if (data.responseText === 'Evernote Authorization Expired') {
        return window.location.reload();
      } else if (data.responseText === 'Notebook Not Found') {
        $('#nb-select-msg').html('We beleive the notebook has been deleted in your Evernote account.<br>Please send a notebook reset request to support.').removeClass('hide');
        $('#nb-select-name-refresh>i').hide();
        return $('#nb-select-name-show>span').hide();
      } else {
        $('#nb-select-name-refresh>i').hide();
        return $('#nb-select-msg').html(' - Failed. Please try again later.').removeClass('hide');
      }
    }).done(function(data) {
      $('#nb-select-name-show>span').html(data.name);
      return $('#nb-select-name-refresh>i').removeClass('icon-spin');
    });
    return refreshing = false;
  };

  $('#menu a').click(function(e) {
    e.preventDefault();
    return $(this).tab('show');
  });

  $('.kl-tooltip').tooltip();

  $('#nb-select-name-refresh').click(function() {
    refresh_notebook_name();
    return false;
  });

  $('#nb').submit(function() {
    if ($('#bio').val().length > 500) {
      $('#nb-msg').html('Length of bio exceeds the max limit.').fadeIn().delay(3000).fadeOut();
      return false;
    }
    $('#nb-spin').fadeIn('fast');
    $('#nb-msg').fadeOut().html('');
    $.ajax({
      type: "PUT",
      url: "/settings/notebook",
      data: $(this).serialize()
    }).done(function() {
      return $('#nb-msg').html('Settings Saved!').fadeIn().delay(5000).fadeOut();
    }).fail(function(data) {
      if (data.responseText !== '') {
        return $('#nb-msg').html(data.responseText).fadeIn();
      } else {
        return $('#nb-msg').html('Failed to save.').fadeIn();
      }
    }).always(function() {
      return $('#nb-spin').fadeOut('fast');
    });
    return false;
  });

  $('#bio').change(function() {
    if ($('#bio').val().length > 500) {
      $('#f-acct-bio-limit').addClass('red');
      $('#f-acct-bio-limit').removeClass('gray');
      return $('#f-acct-btn').addClass('disabled');
    } else {
      $('#f-acct-bio-limit').addClass('gray');
      $('#f-acct-bio-limit').removeClass('red');
      return $('#f-acct-btn').removeClass('disabled');
    }
  });

  $('#form-account').submit(function() {
    $('#f-acct-spin').show();
    $('#f-acct-msg').fadeOut().html('');
    $.ajax({
      type: "PUT",
      url: "/settings/account",
      data: $(this).serialize()
    }).done(function() {
      return $('#f-acct-msg').html('Settings Saved!').fadeIn().delay(5000).fadeOut();
    }).fail(function() {
      return $('#f-acct-msg').html('Failed to save.').fadeIn();
    }).always(function() {
      return $('#f-acct-spin').hide();
    });
    return false;
  });

}).call(this);
